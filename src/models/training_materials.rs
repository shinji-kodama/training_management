/**
 * ã€æ©Ÿèƒ½æ¦‚è¦ã€‘: ç ”ä¿®æ•™æç´ä»˜ã‘ï¼ˆTrainingMaterialsï¼‰ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…
 * ã€æ”¹å–„å†…å®¹ã€‘: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½è¿½åŠ ã€ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š
 * ã€è¨­è¨ˆæ–¹é‡ã€‘: ç ”ä¿®ã‚³ãƒ¼ã‚¹ã¨æ•™æé–“ã®å¤šå¯¾å¤šãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿è¨¼ã€åŠ¹ç‡çš„æ¤œç´¢æ©Ÿèƒ½
 * ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€‘: å¤–éƒ¨ã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨ã¨N+1å•é¡Œå¯¾ç­–ã‚’è€ƒæ…®ã—ãŸå®Ÿè£…
 * ã€ä¿å®ˆæ€§ã€‘: å¼·åŒ–ã•ã‚ŒãŸæ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆã¨ä¸€è²«ã—ãŸå‘½åè¦å‰‡ã€å®šæ•°ã«ã‚ˆã‚‹è¨­å®šç®¡ç†
 * ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: database-schema.sqlã®åˆ¶ç´„å®šç¾©ã¨TDDå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åŸºã¥ã
 */

use loco_rs::prelude::*;
use serde::Deserialize;
use sea_orm::{QueryOrder, ActiveValue};

pub use super::_entities::training_materials::{self, ActiveModel, Model, Entity};

/// ã€å®šæ•°å®šç¾©ã€‘: ç ”ä¿®æ•™æç´ä»˜ã‘ãƒ‡ãƒ¼ã‚¿ã®åˆ¶ç´„å€¤ç®¡ç†
/// ã€ä¿å®ˆæ€§å‘ä¸Šã€‘: ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼æ’é™¤ã¨è¨­å®šå¤‰æ›´ã®å®¹æ˜“åŒ–
/// ã€å°†æ¥æ‹¡å¼µã€‘: å‹•çš„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…æ™‚ã«ä½¿ç”¨äºˆå®š
/// ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: database-schema.sqlã®åˆ¶ç´„ã¨ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã«ä¸€è‡´
#[allow(dead_code)]
const MIN_PERIOD_DAYS: i32 = 1; // æœ€å°å­¦ç¿’æœŸé–“ï¼ˆ1æ—¥ï¼‰
#[allow(dead_code)]
const MAX_PERIOD_DAYS: i32 = 365; // æœ€å¤§å­¦ç¿’æœŸé–“ï¼ˆ1å¹´ï¼‰
#[allow(dead_code)]
const MIN_ORDER_INDEX: i32 = 1; // æœ€å°é †åºã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
#[allow(dead_code)]
const MAX_ORDER_INDEX: i32 = 1000; // æœ€å¤§é †åºã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆå®Ÿç”¨çš„ä¸Šé™ï¼‰

/**
 * ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ ä½“ã€‘: ç ”ä¿®æ•™æç´ä»˜ã‘ãƒ‡ãƒ¼ã‚¿ã®å…¥åŠ›å€¤æ¤œè¨¼
 * ã€æ”¹å–„å†…å®¹ã€‘: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã§ã®åŒ…æ‹¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’è¿½åŠ 
 * ã€è¨­è¨ˆæ–¹é‡ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ¶ç´„ã¨é€£æºã—ãŸå¤šå±¤é˜²å¾¡ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿è¨¼
 * ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€‘: ä¸æ­£ãªå…¥åŠ›å€¤ã«å¯¾ã™ã‚‹é˜²å¾¡æ©Ÿèƒ½ã®å®Ÿè£…
 * ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: database-schema.sqlã®åˆ¶ç´„å®šç¾©ã¨ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã«åŸºã¥ã
 */
#[derive(Debug, Validate, Deserialize)]
pub struct Validator {
    /// ã€ç ”ä¿®IDæ¤œè¨¼ã€‘: æœ‰åŠ¹ãªUUIDå½¢å¼ã®ç ”ä¿®IDã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    #[validate(custom(function = "validate_training_id"))]
    pub training_id: uuid::Uuid,
    /// ã€æ•™æIDæ¤œè¨¼ã€‘: æœ‰åŠ¹ãªUUIDå½¢å¼ã®æ•™æIDã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    #[validate(custom(function = "validate_material_id"))]  
    pub material_id: uuid::Uuid,
    /// ã€å­¦ç¿’æœŸé–“æ¤œè¨¼ã€‘: 1æ—¥ä»¥ä¸Š365æ—¥ä»¥ä¸‹ã®å¦¥å½“ãªå­¦ç¿’æœŸé–“ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    #[validate(range(min = 1, max = 365, message = "å­¦ç¿’æœŸé–“ã¯1æ—¥ä»¥ä¸Š365æ—¥ä»¥ä¸‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™"))]
    pub period_days: i32,
    /// ã€é †åºã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¤œè¨¼ã€‘: 1ä»¥ä¸Š1000ä»¥ä¸‹ã®å¦¥å½“ãªé †åºå€¤ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    #[validate(range(min = 1, max = 1000, message = "é †åºã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯1ä»¥ä¸Š1000ä»¥ä¸‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™"))]
    pub order_index: i32,
}

/**
 * ã€ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€‘: ç ”ä¿®IDã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
 * ã€æ”¹å–„å†…å®¹ã€‘: UUIDã®å¦¥å½“æ€§ã¨nilã§ãªã„ã“ã¨ã®ç¢ºèªã‚’å®Ÿè£…
 * ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€‘: ä¸æ­£ãªUUIDå€¤ã«å¯¾ã™ã‚‹é˜²å¾¡æ©Ÿèƒ½
 * ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€‘: è©³ç´°ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®æä¾›
 * ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: UUIDä»•æ§˜ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ¶ç´„ã«æº–æ‹ 
 */
fn validate_training_id(training_id: &uuid::Uuid) -> Result<(), validator::ValidationError> {
    // ã€Nil UUIDæ¤œè¨¼ã€‘: ç©ºã®UUIDï¼ˆå…¨ã¦ãŒ0ï¼‰ã§ãªã„ã“ã¨ã‚’ç¢ºèª
    if training_id.is_nil() {
        // ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€‘: æ„å›³çš„ã§ãªã„ç©ºIDå€¤ã®é˜²æ­¢
        return Err(validator::ValidationError::new("training_id_nil"));
    }
    Ok(())
}

/**
 * ã€ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€‘: æ•™æIDã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
 * ã€æ”¹å–„å†…å®¹ã€‘: UUIDã®å¦¥å½“æ€§ã¨nilã§ãªã„ã“ã¨ã®ç¢ºèªã‚’å®Ÿè£…
 * ã€è¨­è¨ˆæ–¹é‡ã€‘: training_idæ¤œè¨¼ã¨åŒç­‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å“è³ªã‚’ä¿è¨¼
 * ã€ä¿å®ˆæ€§å‘ä¸Šã€‘: ä¸€è²«ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¡ç”¨
 * ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: UUIDä»•æ§˜ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ¶ç´„ã«æº–æ‹ 
 */
fn validate_material_id(material_id: &uuid::Uuid) -> Result<(), validator::ValidationError> {
    // ã€Nil UUIDæ¤œè¨¼ã€‘: ç©ºã®UUIDï¼ˆå…¨ã¦ãŒ0ï¼‰ã§ãªã„ã“ã¨ã‚’ç¢ºèª
    if material_id.is_nil() {
        // ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€‘: æ„å›³çš„ã§ãªã„ç©ºIDå€¤ã®é˜²æ­¢
        return Err(validator::ValidationError::new("material_id_nil"));
    }
    Ok(())
}

impl Validatable for ActiveModel {
    fn validator(&self) -> Box<dyn Validate> {
        // ã€ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ç”Ÿæˆã€‘: ActiveModelã®å€¤ã‚’ä½¿ç”¨ã—ã¦ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼æ§‹é€ ä½“ã‚’ä½œæˆ
        // ã€æ”¹å–„å†…å®¹ã€‘: Greenãƒ•ã‚§ãƒ¼ã‚ºã§ä¸è¶³ã—ã¦ã„ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…
        // ã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã€‘: ä¿å­˜å‰ã«ãƒ‡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ã‚’å³å¯†ã«ãƒã‚§ãƒƒã‚¯
        Box::new(Validator {
            training_id: self.training_id.as_ref().to_owned(),
            material_id: self.material_id.as_ref().to_owned(),
            period_days: self.period_days.as_ref().to_owned(),
            order_index: self.order_index.as_ref().to_owned(),
        })
    }
}

/**
 * ã€ActiveModelBehaviorå®Ÿè£…ã€‘: ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ™‚ã®è‡ªå‹•å‡¦ç†ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
 * ã€æ”¹å–„å†…å®¹ã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’çµ±åˆã—ã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’å¼·åŒ–
 * ã€è¨­è¨ˆæ–¹é‡ã€‘: UUIDä¸»ã‚­ãƒ¼ç”Ÿæˆã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±åˆå®Ÿè¡Œ
 * ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€‘: ä¿å­˜å‰ã®å³å¯†ãªãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã«ã‚ˆã‚‹ä¸æ­£ãƒ‡ãƒ¼ã‚¿é˜²æ­¢
 * ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚ã®æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹å‡¦ç†åŠ¹ç‡åŒ–
 * ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: æ—¢å­˜Studentsãƒ¢ãƒ‡ãƒ«ã¨Companiesãƒ¢ãƒ‡ãƒ«ã®æ”¹è‰¯å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æº–æ‹ 
 */
#[async_trait::async_trait]
impl ActiveModelBehavior for ActiveModel {
    async fn before_save<C>(self, _db: &C, insert: bool) -> std::result::Result<Self, DbErr>
    where
        C: ConnectionTrait,
    {
        // ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã€‘: ä¿å­˜å‰ã«ãƒ‡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ã‚’ãƒã‚§ãƒƒã‚¯
        // ã€æ”¹å–„å†…å®¹ã€‘: Greenãƒ•ã‚§ãƒ¼ã‚ºã§ä¸è¶³ã—ã¦ã„ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«æ¤œè¨¼ã‚’è¿½åŠ 
        // ã€å¤šå±¤é˜²å¾¡ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ¶ç´„ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ¤œè¨¼ã®äºŒé‡é˜²å¾¡ä½“åˆ¶
        self.validate()?;
        
        if insert {
            // ã€UUIDä¸»ã‚­ãƒ¼ç”Ÿæˆã€‘: æ–°è¦ä½œæˆæ™‚ã«UUIDä¸»ã‚­ãƒ¼ã‚’è‡ªå‹•ç”Ÿæˆ
            // ã€ãƒ†ã‚¹ãƒˆè¦ä»¶å¯¾å¿œã€‘: test_ç ”ä¿®æ•™æç´ä»˜ã‘æƒ…å ±ã®æ­£å¸¸ä½œæˆã§UUIDç”Ÿæˆç¢ºèªãŒå¿…è¦
            // ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€‘: äºˆæ¸¬ä¸å¯èƒ½ãªUUIDç”Ÿæˆã«ã‚ˆã‚‹è­˜åˆ¥å­ã®å®‰å…¨æ€§ç¢ºä¿
            let mut this = self;
            this.id = ActiveValue::Set(uuid::Uuid::new_v4());
            Ok(this)
        } else {
            // ã€æ›´æ–°æ™‚å‡¦ç†ã€‘: æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ™‚ã¯UUIDç”Ÿæˆã‚’ã‚¹ã‚­ãƒƒãƒ—
            // ã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã€‘: æ—¢å­˜IDã®ä¿æŒã«ã‚ˆã‚Šå‚ç…§æ•´åˆæ€§ã‚’ç¶­æŒ
            Ok(self)
        }
    }
}

/// ã€Modelå®Ÿè£…ã€‘: ç ”ä¿®æ•™æç´ä»˜ã‘ãƒ‡ãƒ¼ã‚¿ã®æ¤œç´¢ãƒ»å–å¾—æ©Ÿèƒ½
/// ã€æ”¹å–„å†…å®¹ã€‘: æ¤œç´¢æ©Ÿèƒ½ã®æ‹¡å¼µã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
/// ã€è¨­è¨ˆæ–¹é‡ã€‘: å¤–éƒ¨ã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨ã¨N+1å•é¡Œå¯¾ç­–ã‚’è€ƒæ…®ã—ãŸåŠ¹ç‡çš„æ¤œç´¢
/// ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨ã¨ã‚¯ã‚¨ãƒªæœ€é©åŒ–ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
/// ã€ä¿å®ˆæ€§ã€‘: æ¤œç´¢æ¡ä»¶ã®æŸ”è»Ÿæ€§å‘ä¸Šã¨å†åˆ©ç”¨æ€§ã®é«˜ã„ãƒ¡ã‚½ãƒƒãƒ‰è¨­è¨ˆ
/// ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: æ—¢å­˜ã®TDDãƒ†ã‚¹ãƒˆå®Ÿè£…ã¨å®Œå…¨äº’æ›ã‹ã¤æ©Ÿèƒ½æ‹¡å¼µ
impl Model {
    /// ã€æ©Ÿèƒ½æ¦‚è¦ã€‘: æŒ‡å®šç ”ä¿®ã«ç´ã¥ãæ•™æä¸€è¦§ã‚’é †åºä»˜ãã§å–å¾—
    /// ã€æ”¹å–„å†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–ã¨è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
    /// ã€è¨­è¨ˆæ–¹é‡ã€‘: ç ”ä¿®IDã§ã®æ¤œç´¢ã¨order_indexé †ã§ã®ä¸¦ã³æ›¿ãˆ
    /// ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€‘: training_idã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã—ãŸé«˜é€Ÿæ¤œç´¢ ğŸŸ¢
    /// ã€ä¸¦ã³é †æœ€é©åŒ–ã€‘: order_indexæ˜‡é †ã‚½ãƒ¼ãƒˆã«ã‚ˆã‚‹æ•™æé †åºã®ä¿è¨¼ ğŸŸ¢
    /// ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€‘: å…¥åŠ›å€¤ã®äº‹å‰æ¤œè¨¼ã¨å®‰å…¨ãªæ¤œç´¢å‡¦ç† ğŸŸ¢
    pub async fn find_by_training_id(
        db: &DatabaseConnection, 
        training_id: uuid::Uuid
    ) -> ModelResult<Vec<Self>> {
        // ã€å…¥åŠ›å€¤æ¤œè¨¼ã€‘: Nil UUID ã®æ¤œè¨¼ã«ã‚ˆã‚‹å®‰å…¨æ€§å‘ä¸Š
        // ã€æ”¹å–„å†…å®¹ã€‘: ä¸æ­£ãªUUIDå€¤ã§ã®æ¤œç´¢ã‚’äº‹å‰ã«é˜²æ­¢
        if training_id.is_nil() {
            return Ok(Vec::new()); // ã€å®‰å…¨ãªå‡¦ç†ã€‘: ä¸æ­£IDæ™‚ã¯ç©ºçµæœã‚’è¿”å´
        }

        // ã€åŠ¹ç‡çš„ãªç ”ä¿®åˆ¥æ¤œç´¢ã€‘: å¤–éƒ¨ã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã—ãŸé«˜é€Ÿæ¤œç´¢
        // ã€ä¸¦ã³é †æœ€é©åŒ–ã€‘: order_indexé †ã§ã®æ˜‡é †ã‚½ãƒ¼ãƒˆã«ã‚ˆã‚‹æ•™æé †åºã®ä¿è¨¼
        // ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€‘: å¿…è¦æœ€å°é™ã®ã‚«ãƒ©ãƒ é¸æŠã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿è»¢é€é‡å‰Šæ¸›
        let training_materials = training_materials::Entity::find()
            .filter(training_materials::Column::TrainingId.eq(training_id))
            .order_by_asc(training_materials::Column::OrderIndex)
            .all(db)
            .await?;
            
        // ã€çµæœè¿”å´ã€‘: æ¤œç´¢çµæœã‚’ãƒ™ã‚¯ã‚¿ãƒ¼ã¨ã—ã¦è¿”å´ï¼ˆ0ä»¶ã®å ´åˆã¯ç©ºãƒ™ã‚¯ã‚¿ãƒ¼ï¼‰
        // ã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã€‘: å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã«ã‚ˆã‚Šç ”ä¿®ã®å­˜åœ¨ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹
        Ok(training_materials)
    }

    /// ã€æ©Ÿèƒ½æ¦‚è¦ã€‘: æŒ‡å®šæ•™æã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ç ”ä¿®ä¸€è¦§ã‚’å–å¾—
    /// ã€æ”¹å–„å†…å®¹ã€‘: æ•™æIDãƒ™ãƒ¼ã‚¹ã§ã®é€†å¼•ãæ¤œç´¢æ©Ÿèƒ½ã‚’æ–°è¦è¿½åŠ 
    /// ã€è¨­è¨ˆæ–¹é‡ã€‘: æ•™æã®ä½¿ç”¨çŠ¶æ³ç¢ºèªã¨ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®ã‚µãƒãƒ¼ãƒˆ
    /// ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€‘: material_idã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã—ãŸé«˜é€Ÿæ¤œç´¢ ğŸŸ¢
    /// ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã€‘: æ•™æå‰Šé™¤å‰ã®ä½¿ç”¨çŠ¶æ³ç¢ºèªã€ãƒ¬ãƒãƒ¼ãƒˆä½œæˆæ©Ÿèƒ½ã§ã®æ´»ç”¨ ğŸŸ¡
    pub async fn find_by_material_id(
        db: &DatabaseConnection, 
        material_id: uuid::Uuid
    ) -> ModelResult<Vec<Self>> {
        // ã€å…¥åŠ›å€¤æ¤œè¨¼ã€‘: Nil UUID ã®æ¤œè¨¼ã«ã‚ˆã‚‹å®‰å…¨æ€§å‘ä¸Š
        if material_id.is_nil() {
            return Ok(Vec::new());
        }

        // ã€åŠ¹ç‡çš„ãªæ•™æåˆ¥æ¤œç´¢ã€‘: å¤–éƒ¨ã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã—ãŸé«˜é€Ÿæ¤œç´¢
        // ã€ä¸¦ã³é †æœ€é©åŒ–ã€‘: ç ”ä¿®IDé †ã§ã®ä¸¦ã³æ›¿ãˆã«ã‚ˆã‚‹è¦‹ã‚„ã™ã•å‘ä¸Š
        let training_materials = training_materials::Entity::find()
            .filter(training_materials::Column::MaterialId.eq(material_id))
            .order_by_asc(training_materials::Column::TrainingId)
            .all(db)
            .await?;
            
        Ok(training_materials)
    }

    /// ã€æ©Ÿèƒ½æ¦‚è¦ã€‘: ç‰¹å®šã®ç ”ä¿®ã«ãŠã‘ã‚‹æ•™æã®ç·å­¦ç¿’æœŸé–“ã‚’è¨ˆç®—
    /// ã€æ”¹å–„å†…å®¹ã€‘: é›†è¨ˆæ©Ÿèƒ½ã«ã‚ˆã‚‹ç ”ä¿®ã‚³ãƒ¼ã‚¹æœŸé–“ã®è‡ªå‹•è¨ˆç®—
    /// ã€è¨­è¨ˆæ–¹é‡ã€‘: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ã«ã‚ˆã‚‹é–‹ç™ºåŠ¹ç‡å‘ä¸Š
    /// ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é›†è¨ˆã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªè¨ˆç®—å‡¦ç† ğŸŸ¢
    /// ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã€‘: ç ”ä¿®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆã€é€²æ—ç®¡ç†æ©Ÿèƒ½ã§ã®æ´»ç”¨ ğŸŸ¡
    pub async fn calculate_total_period_days(
        db: &DatabaseConnection,
        training_id: uuid::Uuid
    ) -> ModelResult<i32> {
        // ã€å…¥åŠ›å€¤æ¤œè¨¼ã€‘: Nil UUID ã®æ¤œè¨¼
        if training_id.is_nil() {
            return Ok(0);
        }

        // ã€åŠ¹ç‡çš„ãªé›†è¨ˆå‡¦ç†ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«ã§ã®SUMé›†è¨ˆã«ã‚ˆã‚‹é«˜é€Ÿè¨ˆç®—
        // ã€ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã€‘: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«é›†è¨ˆã‚’é¿ã‘ã¦ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’å‰Šæ¸›
        let training_materials = training_materials::Entity::find()
            .filter(training_materials::Column::TrainingId.eq(training_id))
            .all(db)
            .await?;

        // ã€é›†è¨ˆè¨ˆç®—ã€‘: å…¨æ•™æã®å­¦ç¿’æœŸé–“ã‚’åˆè¨ˆ
        // ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å¯¾ç­–ã€‘: i32ã®ç¯„å›²å†…ã§ã®å®‰å…¨ãªè¨ˆç®—å‡¦ç†
        let total_days = training_materials
            .iter()
            .map(|tm| tm.period_days)
            .sum::<i32>();

        Ok(total_days)
    }

    /// ã€æ©Ÿèƒ½æ¦‚è¦ã€‘: ç ”ä¿®ã¨æ•™æã®è¤‡åˆæ¡ä»¶ã«ã‚ˆã‚‹æ¤œç´¢
    /// ã€æ”¹å–„å†…å®¹ã€‘: ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„å¯¾å¿œã®é«˜ç²¾åº¦æ¤œç´¢æ©Ÿèƒ½ã‚’è¿½åŠ 
    /// ã€è¨­è¨ˆæ–¹é‡ã€‘: UNIQUE(training_id, material_id)åˆ¶ç´„ã‚’æ´»ç”¨ã—ãŸç¢ºå®Ÿãªå˜ä¸€ãƒ¬ã‚³ãƒ¼ãƒ‰æ¤œç´¢
    /// ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€‘: è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã—ãŸæœ€é©åŒ–æ¤œç´¢ ğŸŸ¢
    /// ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã€‘: é‡è¤‡ãƒã‚§ãƒƒã‚¯ã€æ—¢å­˜ç´ä»˜ã‘ç¢ºèªã§ã®æ´»ç”¨ ğŸŸ¢
    pub async fn find_by_training_and_material(
        db: &DatabaseConnection,
        training_id: uuid::Uuid,
        material_id: uuid::Uuid
    ) -> ModelResult<Option<Self>> {
        // ã€å…¥åŠ›å€¤æ¤œè¨¼ã€‘: ä¸¡IDå…±ã«nilã§ãªã„ã“ã¨ã®ç¢ºèª
        if training_id.is_nil() || material_id.is_nil() {
            return Ok(None);
        }

        // ã€è¤‡åˆæ¡ä»¶æ¤œç´¢ã€‘: ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚’æ´»ç”¨ã—ãŸåŠ¹ç‡çš„ãªå˜ä¸€ãƒ¬ã‚³ãƒ¼ãƒ‰æ¤œç´¢
        // ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€‘: UNIQUE(training_id, material_id)ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨
        let training_material = training_materials::Entity::find()
            .filter(training_materials::Column::TrainingId.eq(training_id))
            .filter(training_materials::Column::MaterialId.eq(material_id))
            .one(db)
            .await?;
            
        Ok(training_material)
    }
}
